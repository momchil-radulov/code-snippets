# install opensearch
## install
curl -o- https://artifacts.opensearch.org/publickeys/opensearch.pgp | sudo apt-key add -
echo "deb https://artifacts.opensearch.org/releases/bundle/opensearch/2.x/apt stable main" | sudo tee -a /etc/apt/sources.list.d/opensearch-2.x.list
echo "deb https://artifacts.opensearch.org/releases/bundle/opensearch-dashboards/2.x/apt stable main" | sudo tee -a /etc/apt/sources.list.d/opensearch-dashboards-2.x.list
sudo apt-get update
sudo apt list -a opensearch
sudo apt list -a opensearch-dashboards
sudo apt-get install opensearch
sudo apt-get install opensearch-dashboards
sudo apt-get upgrade opensearch
sudo apt-get upgrade opensearch-dashboards
## enable and run
sudo systemctl enable opensearch
sudo systemctl start opensearch
sudo systemctl status opensearch
sudo systemctl enable opensearch-dashboards
sudo systemctl start opensearch-dashboards
sudo systemctl status opensearch-dashboards
## test
curl -X GET https://localhost:9200 -u 'admin:admin' --insecure
## urls
curl -X GET https://localhost:9200/_cat/plugins?v -u 'admin:admin' --insecure  # get plugins

## settings

[/etc/opensearch/opensearch.yml]
network.host: 0.0.0.0
discovery.type: single-node
plugins.security.disabled: true

## disable opensearch-dashboards security plugin
cd /usr/share/opensearch-dashboards
bin/opensearch-dashboards-plugin list
sudo bin/opensearch-dashboards-plugin remove --allow-root securityDashboards

[/etc/opensearch-dashboards/opensearch_dashboards.yml]
server.host: 0.0.0.0
opensearch.hosts: [http://localhost:9200]
#opensearch_security.multitenancy.enabled: true
#opensearch_security.multitenancy.tenants.preferred: [Private, Global]
#opensearch_security.readonly_mode.roles: [kibana_read_only]
## Use this setting if you are running opensearch-dashboards without https
#opensearch_security.cookie.secure: false

## restart
sudo systemctl restart opensearch
sudo systemctl restart opensearch-dashboards
## test
curl http://localhost:9200
curl http://localhost:5601 -u 'admin:admin' --insecure
## urls
curl http://localhost:9200/_cat/plugins?v


# nginx proxy, 216.58.212.14 => replace with your ip
sudo systemctl stop nginx
sudo systemctl status nginx
sudo systemctl start nginx
sudo systemctl reload nginx.service
#log
$systemctl status nginx.service
$journalctl -xe
[sudo vim /etc/nginx/sites-enabled/default]
server {
        listen 216.58.212.14:9200;
        location / {
                proxy_pass http://localhost:9200;
        }
}

# schema
PUT /documents
{
  "mappings": {
    "dynamic": "strict",
    "properties": {
      "fileName": {
        "type": "keyword"
      },
      "id": {
        "type": "integer"
      },
      "hash": {
        "type": "keyword"
      },
      "content": {
        "type": "text"
      }
    }
  },
  "settings" : {
    "index" : {
      "number_of_shards": 2,
      "number_of_replicas": 2
    }
  }
}

# query
GET documents/_search
{ "query": {
    "bool": {
      "must": [
        {"match": {"content": "hello world"}},
        {"term": {"id": 8787}},
        {"wildcard": {"fileName": {"value": "*note*"}}}
      ] 
    } 
  }
}
