# for node-red with mosquitto
docker compose up -d  # start
docker compose up     # for debugging
docker compose stop   # stop
docker-compose -f docker-compose.php56.yml restart
docker ps
docker exec -it -u root mosquitto /bin/sh  # enter in container
docker exec -it msys-php56-app bash
docker logs msys-php56-app
mysql -h 127.0.0.1 -P 33061 -u root -proot
gunzip -c database_name_2026-02-11.sql.gz | mysql -h 127.0.0.1 -P 33061 -uroot -proot database_name
CREATE USER IF NOT EXISTS 'app_user'@'%' IDENTIFIED BY 'SILNA_PAROLA';
GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, ALTER, INDEX, DROP, EXECUTE ON database_name.* TO 'app_user'@'%';
FLUSH PRIVILEGES;
!!! docker compose down  # delete containers !!!

# списък услуги
docker-compose -f docker-compose.php56.yml config --services
# логове (замени <php_service> с името от горната команда)
docker-compose -f docker-compose.php56.yml logs -f --tail=200 <php_service>
docker-compose -f docker-compose.php56.yml logs -f --tail=200 app

[compose.yaml]
version: "3.9"
services:
  mosquitto:
    container_name: mosquitto
    image: eclipse-mosquitto
    volumes:
      - "./mosquitto/config:/mosquitto/config"
    networks:
      - mosquitto_net
    ports:
      - "1883:1883"
      - "9001:9001"
  node-red:
    container_name: nodered
    depends_on:
      - mosquitto
    image: nodered/node-red
    volumes:
      - "./node-red/data:/data"
    networks:
      - mosquitto_net
    ports:
      - "1880:1880"
networks:
  mosquitto_net:
    name: mosquitto_net

docker-compose -f /path_to/docker-compose.php56.yml up -d homestead
docker-compose -f /path_to/docker-compose.php56.yml exec -T homestead \
    mysql -uroot -proot -e "DROP DATABASE db_name; CREATE DATABASE db_name CHARACTER SET utf8 COLLATE utf8_general_ci;"
docker-compose -f docker-compose.php56.yml exec homestead bash  # bash shell
docker-compose -f docker-compose.php56.yml exec homestead mysql -uroot -proot  # mysql shell
SHOW DATABASES; USE your_database_name; SHOW TABLES;
gunzip -c /path_to/db_name_2026-02-20.sql.gz | \
    docker-compose -f /path_to/docker-compose.php56.yml exec -T homestead \
    mysql -uroot -proot db_name

[docker-compose.php56.yml]
version: "2.4"

services:
  app:
    build:
      context: .
      dockerfile: docker/php56/Dockerfile
    container_name: msys-php56-app
    ports:
      - "8080:80"
    volumes:
      - ./:/var/www/html
    environment:
      CI_ENV: development
    depends_on:
      homestead:
        condition: service_healthy
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped

  homestead:
    image: mariadb:10.3
    container_name: msys-php56-db
    command: --character-set-server=utf8 --collation-server=utf8_general_ci
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: database_name
      MYSQL_USER: homestead
      MYSQL_PASSWORD: secret
    ports:
      - "33061:3306"
    volumes:
      - ./tmp/docker/mysql:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "127.0.0.1", "-uroot", "-proot"]
      interval: 5s
      timeout: 3s
      retries: 20
    networks:
      default:
        aliases:
          - Homestead
    restart: unless-stopped

[Dockerfile] 
FROM php:5.6-apache

RUN sed -i 's|deb.debian.org/debian|archive.debian.org/debian|g; s|security.debian.org/debian-security|archive.debian.org/debian-security|g' /etc/apt/sources.list \
    && sed -i '/stretch-updates/d' /etc/apt/sources.list \
    && printf 'Acquire::Check-Valid-Until "false";\nAcquire::AllowInsecureRepositories "true";\nAcquire::AllowDowngradeToInsecureRepositories "true";\n' > /etc/apt/apt.conf.d/99archive \
    && apt-get update \
    && apt-get install -y --allow-unauthenticated --no-install-recommends \
    libpng-dev \
    libjpeg62-turbo-dev \
    libfreetype6-dev \
    libzip-dev \
    zlib1g-dev \
    libicu-dev \
    libmcrypt-dev \
    unzip \
    git \
    && docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \
    && docker-php-ext-install -j"$(nproc)" mysqli pdo pdo_mysql mysql mbstring gd zip intl mcrypt \
    && a2enmod rewrite \
    && rm -rf /var/lib/apt/lists/*

COPY docker/php56/php.ini /usr/local/etc/php/conf.d/zzz-msys.ini

WORKDIR /var/www/html
