import schedule
import time
import threading

# 1. Създаваме Event, който ще служи като сигнал за спиране
stop_event = threading.Event()

def задача():
    """Това е функцията, която искате да изпълните в определен час."""
    print("Време е! Изпълнявам задачата в отделна нишка.")
    # Тук поставете кода, който искате да се изпълни.

def стартирай_планировчика():
    """Тази функция ще се изпълнява, докато не получим сигнал за спиране."""
    print("Планировчикът е стартиран. Натиснете Ctrl+C за спиране.")
    # 2. Цикълът вече се изпълнява, докато event-ът НЕ е сетнат
    while not stop_event.is_set():
        schedule.run_pending()
        # Използваме wait() вместо sleep(), за да реагираме веднага на сигнала
        stop_event.wait(1)

# Планирайте задачата да се изпълни (например на всяка минута за тест)
# schedule.every().day.at("15:30").do(задача)
schedule.every(1).minute.do(задача)


# Създайте и стартирайте нишка за планировчика
planner_thread = threading.Thread(target=стартирай_планировчика)
planner_thread.start()

# 3. Основната програма влиза в try...except блок
try:
    # Държим основната нишка жива, за да можем да хванем Ctrl+C
    while True:
        time.sleep(1)
except KeyboardInterrupt:
    print("Подаден сигнал за спиране...")
    # 4. При Ctrl+C, сетваме event-a, което ще прекрати цикъла в нишката
    stop_event.set()
    # 5. Изчакваме нишката да приключи своята работа напълно
    planner_thread.join()
    print("Програмата е спряна успешно.")
