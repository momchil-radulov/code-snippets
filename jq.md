
# Туториал: Работа с `jq`, `yq`, и `xq` за ежедневни задачи

## 1. Въведение
В този туториал ще разгледаме как да използваш `jq`, `yq`, и `xq` за работа с JSON, YAML и XML данни. Ще включим както базови примери, така и по-сложни казуси, които често възникват в DevOps, разработка на софтуер и системна администрация.

## 2. Инсталиране

### 2.1 Инсталиране на `jq`
`jq` се използва за обработка на JSON файлове.

- **Ubuntu/Debian:**
  ```bash
  sudo apt-get install jq
  ```

- **macOS с Homebrew:**
  ```bash
  brew install jq
  ```

### 2.2 Инсталиране на `yq`
`yq` се използва за работа с YAML файлове. Може да се инсталира чрез pip или Snap.

- **Чрез pip:**
  ```bash
  pip install yq
  ```

- **Чрез Snap (на Ubuntu/Debian):**
  ```bash
  sudo snap install yq
  ```

### 2.3 Инсталиране на `xq`
`xq` е част от пакета `yq`, така че ако си инсталирал `yq`, вече имаш достъп до `xq`.

## 3. Основни примери

### 3.1 `jq` за работа с JSON

#### 3.1.1 Извличане на данни
Ако имаш JSON файл `data.json` със следното съдържание:

```json
{
  "име": "Иван",
  "възраст": 30,
  "адрес": {
    "град": "София",
    "улица": "Иван Вазов 5"
  }
}
```

**Извличане на вложени стойности:**
```bash
jq '.адрес.град' data.json
```
**Резултат:** `"София"`

#### 3.1.2 Филтриране на масиви
Ако имаш JSON масив:

```json
[
  {"име": "Иван", "възраст": 30},
  {"име": "Мария", "възраст": 25},
  {"име": "Петър", "възраст": 35}
]
```

**Извличане на всички имена:**
```bash
jq '.[].име' data.json
```
**Резултат:**
```bash
"Иван"
"Мария"
"Петър"
```

**Филтриране по условие:**
```bash
jq '.[] | select(.възраст > 30)' data.json
```
**Резултат:**
```json
{"име": "Петър", "възраст": 35}
```

#### 3.1.3 Преобразуване на JSON
**Добавяне на нов ключ:**
```bash
jq '. + {"професия": "програмист"}' data.json
```

### 3.2 `yq` за работа с YAML

#### 3.2.1 Извличане и промяна на стойности
Ако имаш YAML файл `data.yml` със съдържание:

```yaml
име: Иван
възраст: 30
адрес:
  град: София
  улица: Иван Вазов 5
```

**Извличане на вложена стойност:**
```bash
yq '.адрес.град' data.yml
```
**Резултат:** `"София"`

**Промяна на стойност:**
```bash
yq '.възраст = 31' data.yml
```

#### 3.2.2 Конвертиране между формати
**Конвертиране на YAML в JSON:**
```bash
yq -o=json . data.yml > data.json
```

**Конвертиране на JSON в YAML:**
```bash
yq -p=json . data.json > data.yml
```

### 3.3 `xq` за работа с XML

#### 3.3.1 Извличане на данни от XML
Ако имаш XML файл `data.xml` със следното съдържание:

```xml
<root>
  <име>Иван</име>
  <възраст>30</възраст>
  <адрес>
    <град>София</град>
    <улица>Иван Вазов 5</улица>
  </адрес>
</root>
```

**Извличане на стойности:**
```bash
xq '.root.адрес.град' data.xml
```
**Резултат:** `"София"`

#### 3.3.2 Конвертиране на XML към JSON
**Цялостно конвертиране на XML към JSON:**
```bash
xq . data.xml > data.json
```

## 4. Разпространени казуси

### 4.1 Работа с конфигурационни файлове
Много конфигурационни файлове са написани в JSON или YAML формат. Например:

**Промяна на стойност в конфигурационен файл:**
```bash
yq '.database.host = "new_host"' config.yml
```

### 4.2 Обработка на API отговори
Много API-та връщат JSON данни. С `jq` можеш лесно да филтрираш и обработваш тези отговори.

**Извличане на определени полета от API отговор:**
```bash
curl -s https://api.example.com/data | jq '.results[] | {name, id}'
```
```bash
jq '[.[] | {id, parent, name: (.name[] | select(.language_code == "bg") | .text)}]' categories.json
```

### 4.3 Преобразуване на данни за автоматизация
В DevOps често се налага да конвертираш и обработваш данни от различни формати, за да ги използваш в автоматизирани скриптове.

**Конвертиране на конфигурационни файлове между формати:**
```bash
yq -p=json . config.json > config.yml
```

## 5. Заключение
`jq`, `yq`, и `xq` са мощни инструменти за работа със структурирани данни и са особено полезни за системни администратори, DevOps инженери и разработчици. С този туториал, ти си подготвен да се справиш с най-често срещаните задачи, свързани с обработката на JSON, YAML и XML данни.

Можеш да експериментираш с тези инструменти и да ги интегрираш във всекидневната си работа, за да автоматизираш рутинни задачи и да улесниш обработката на данни.
